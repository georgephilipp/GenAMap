##############################################
##          CREATE TABLES FOR ALL USERS     ##
##############################################
# These tables are used to interact with condor and
#  to manage users and teams

CREATE TABLE status (value VARCHAR (3) UNIQUE) ENGINE = INNODB;

CREATE TABLE jobstatus (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, appID VARCHAR(7) NOT NULL, status VARCHAR(3) NOT NULL DEFAULT 'INI', percmpt int NOT NULL DEFAULT 0, start TIMESTAMP DEFAULT NOW(), end TIMESTAMP, FOREIGN KEY (status) REFERENCES status(value) ON DELETE CASCADE) ENGINE = INNODB;

CREATE TABLE error (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, jobid INT NOT NULL, error VARCHAR(200), FOREIGN KEY (jobid) REFERENCES jobstatus(id) ON DELETE CASCADE) ENGINE=INNODB;

CREATE TABLE jobtype (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50) NOT NULL, nosteps INT NOT NULL) ENGINE=INNODB;

CREATE TABLE step (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50) NOT NULL, pos INT NOT NULL, exe VARCHAR(200) NOT NULL, jobtypeid INT NOT NULL, priority INT NOT NULL DEFAULT 0, FOREIGN KEY(jobtypeid) REFERENCES jobtype(id) ON DELETE CASCADE) ENGINE=INNODB;

CREATE TABLE jobrun (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, jobtype INT NOT NULL, step INT NOT NULL DEFAULT 0, complete BOOL NOT NULL DEFAULT 0, loc VARCHAR(100) NOT NULL, cont BOOL NOT NULL DEFAULT 1, jobid INT NOT NULL, projectid INT NOT NULL, traitid INT NOT NULL, markerid INT NOT NULL, FOREIGN KEY(jobtype) REFERENCES jobtype(id) ON DELETE CASCADE, FOREIGN KEY(jobid) REFERENCES jobstatus(id), FOREIGN KEY (projectid) REFERENCES project(id), userid INT NOT NULL, FOREIGN KEY(userid) REFERENCES user(id)) ENGINE=INNODB;

CREATE TABLE pause (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, jobid INT NOT NULL, done BOOL NOT NULL DEFAULT 0, killit BOOL NOT NULL DEFAULT 0, FOREIGN KEY(jobid) REFERENCES jobstatus(id)) ENGINE = INNODB;

CREATE TABLE condorid (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, jobid INT NOT NULL, step INT NOT NULL, condorid INT NOT NULL, finished TINYINT(1) DEFAULT 0, FOREIGN KEY(jobid) REFERENCES jobstatus(id)) ENGINE = INNODB; 

CREATE TABLE team (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, name CHAR(15) NOT NULL, passcode VARCHAR(20) NOT NULL, keycode CHAR(1) NOT NULL, algoidx INT NOT NULL DEFAULT 0) ENGINE = INNODB;
ALTER TABLE team ADD UNIQUE(name);

CREATE TABLE user (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, uid CHAR(8) NOT NULL UNIQUE, password VARCHAR(250) NOT NULL, db CHAR(50) NOT NULL DEFAULT 'geneassoc', org CHAR(100) NOT NULL, email CHAR(100) NOT NULL, name CHAR(100) NOT NULL, teamid INT, FOREIGN KEY (teamid) REFERENCES team(id)) ENGINE=INNODB;

CREATE TABLE project(id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, name CHAR(20) NOT NULL, deleted BOOL DEFAULT FALSE, teamid INT NOT NULL, FOREIGN KEY (teamid) REFERENCES team(id)) ENGINE=INNODB;

CREATE TABLE species(id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, name CHAR(100) NOT NULL) ENGINE=INNODB;

